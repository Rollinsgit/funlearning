<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juliette's Learning Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Comic Sans MS', 'Trebuchet MS', 'Arial', sans-serif; 
            background: linear-gradient(135deg, #FFB6D9, #FFD700, #87CEEB, #98FF98);
            padding: 15px; 
            color: #333; 
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { 
            background: linear-gradient(135deg, #FF1493, #FF69B4);
            padding: 25px; 
            border-radius: 25px; 
            margin-bottom: 20px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            text-align: center;
            border: 5px solid #FFD700;
        }
        .header h1 { color: white; font-size: 2.5rem; text-shadow: 3px 3px 0px rgba(0,0,0,0.3); }
        .header p { color: white; font-size: 1.2rem; margin-top: 10px; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab-btn { 
            background: linear-gradient(135deg, #00D4FF, #0099FF);
            padding: 15px 20px; 
            border-radius: 20px; 
            cursor: pointer; 
            font-weight: 700; 
            color: white; 
            border: 4px solid white;
            font-size: 1rem;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .tab-btn.active { background: linear-gradient(135deg, #FF1493, #FF69B4); border-color: #FFD700; }
        .content { 
            background: white; padding: 25px; border-radius: 20px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.15); display: none; border: 5px solid #FFD700;
        }
        .content.active { display: block; }
        .section { background: #FFE4E1; padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 3px dashed #FF69B4; }
        .activity-card {
            background: white; padding: 12px; border-radius: 10px; margin-bottom: 10px;
            border: 3px solid #FFD700; display: flex; align-items: center; gap: 15px; cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .activity-card.checked { background: linear-gradient(135deg, #98FF98, #00FF00); border-color: #00AA00; transform: scale(1.02); }
        input[type="checkbox"] { width: 40px; height: 40px; cursor: pointer; accent-color: #00AA00; }
        
        /* POP ANIMATION FOR BADGES */
        @keyframes badgePop {
            0% { transform: scale(1); }
            50% { transform: scale(1.4) rotate(10deg); }
            100% { transform: scale(1.1) rotate(5deg); }
        }
        .badge-btn { background: linear-gradient(135deg, #FFD700, #FFA500); padding: 20px; border-radius: 15px; border: 4px solid #FF1493; font-size: 2.2rem; cursor: pointer; transition: all 0.3s; }
        .badge-btn.earned { animation: badgePop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; border-color: #00AA00; background: linear-gradient(135deg, #98FF98, #00FF00); }
        
        /* REST OF STYLE RETAINED */
        .btn { background: #0099FF; color: white; padding: 12px 20px; border: 3px solid white; border-radius: 15px; cursor: pointer; font-weight: 700; }
        .btn-danger { background: #FF6B6B; }
        .book-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .book-btn { background: #FF69B4; padding: 10px; border-radius: 12px; border: 4px solid #FF1493; text-align: center; cursor: pointer; color: white; }
        .book-btn.selected { background: #FFD700; color: #FF1493; }
        .badge-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéâ Juliette's Learning Adventure! üéâ</h1>
            <p>Learn, Play, and Earn Rewards!</p>
        </div>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('activities')">üìö Learning Activities</button>
            <button class="tab-btn" onclick="showTab('books')">üìñ Pick a Book</button>
            <button class="tab-btn" onclick="showTab('rewards')">üèÜ Rewards</button>
            <button class="tab-btn" onclick="showTab('manage')">‚öôÔ∏è Add New</button>
        </div>
        
        <div id="activities" class="content active">
            <h2>üìö My Learning Activities</h2>
            <button class="btn btn-danger" onclick="resetDay()">üîÑ Reset Today</button>
            <div class="section" id="activitySection"></div>
        </div>
        
        <div id="books" class="content">
            <h2>üìñ Pick a Book!</h2>
            <div class="book-grid" id="bookGrid"></div>
            <div id="currentBook" style="margin-top:20px; font-weight:bold;"></div>
        </div>
        
        <div id="rewards" class="content">
            <h2>üèÜ My Rewards</h2>
            <div class="badge-grid" id="badgeGrid"></div>
            <h3>Badges Earned üéâ</h3>
            <div id="earnedDisplay" style="display:flex; gap:10px; margin-top:10px;"></div>
        </div>

        <div id="manage" class="content">
            <h2>‚ûï Add New Items</h2>
            <div class="section">
                <input type="text" id="badgeEmoji" placeholder="Emoji">
                <input type="text" id="badgeTitle" placeholder="Name">
                <button class="btn" onclick="addBadge()">Add Badge</button>
            </div>
        </div>
    </div>

    <script>
        // --- FIXED SOUNDS ---
        // Using high-quality sound links
        const woodBlockSound = new Audio('https://www.soundjay.com/button/sounds/button-20.mp3'); 
        const rewardChime = new Audio('https://www.soundjay.com/communication/sounds/bell-ringing-05.mp3');
        
        woodBlockSound.volume = 0.2; 
        rewardChime.volume = 0.1;

        const FIREBASE_URL = 'https://funlearning-f53a4-default-rtdb.firebaseio.com';
        const DEVICE_ID = 'juliette_shared_data';

        let books = [["üìö", "My First Book", null, "A fun start!"]];
        let badges = [["üåü", "Star Learner"], ["üèÖ", "Hard Worker"], ["üé®", "Artist"], ["üìñ", "Book Worm"]];
        let earnedBadges = [];
        let selectedBook = null;

        const activityList = [
            {id: 1, label: "üì± Reading.com"}, {id: 2, label: "üåä SplashLearn"},
            {id: 3, label: "üåç Lingokids"}, {id: 4, label: "üéì Khan Academy Kids"},
            {id: 5, label: "üìö Bob Books"}, {id: 6, label: "üìñ Readers & Books"},
            {id: 7, label: "‚úèÔ∏è Grooved Books"}, {id: 8, label: "üé® Arts & Crafts"},
            {id: 9, label: "üî¨ Science Projects"}
        ];

        function playSound(type) {
            const s = (type === 'wood') ? woodBlockSound : rewardChime;
            s.currentTime = 0;
            s.play().catch(() => console.log("User must interact with page first"));
        }

        function renderActivities() {
            let html = '';
            activityList.forEach(a => {
                html += `
                <div class="activity-card" id="a${a.id}" onclick="handleCardClick(${a.id})">
                    <input type="checkbox" id="c${a.id}" onclick="event.stopPropagation(); updateActivityCard(${a.id})">
                    <label style="flex:1; cursor:pointer;">${a.label}</label>
                </div>`;
            });
            document.getElementById('activitySection').innerHTML = html;
        }

        function handleCardClick(id) {
            const cb = document.getElementById('c' + id);
            cb.checked = !cb.checked;
            updateActivityCard(id);
        }

        function updateActivityCard(id, silent = false) {
            const cb = document.getElementById('c' + id);
            const card = document.getElementById('a' + id);
            if (cb.checked) {
                card.classList.add('checked');
                if (!silent) playSound('wood'); // NEW SOUND
            } else {
                card.classList.remove('checked');
            }
            save();
        }

        function toggleBadge(idx) {
            if (earnedBadges.includes(idx)) {
                earnedBadges = earnedBadges.filter(i => i !== idx);
            } else {
                earnedBadges.push(idx);
                playSound('reward'); // OLD CHIME + POP ANIMATION
            }
            displayRewards();
            save();
        }

        function showTab(tab) {
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            event.target.classList.add('active');
        }

        function displayRewards() {
            let html = '';
            badges.forEach((b, i) => {
                const earnedClass = earnedBadges.includes(i) ? 'earned' : '';
                html += `<div class="badge-btn ${earnedClass}" onclick="toggleBadge(${i})">${b[0]}</div>`;
            });
            document.getElementById('badgeGrid').innerHTML = html;
            
            let earned = '';
            earnedBadges.forEach(i => earned += `<div style="font-size:2rem; background:white; padding:10px; border-radius:10px; border:2px solid #00AA00;">${badges[i][0]}</div>`);
            document.getElementById('earnedDisplay').innerHTML = earned;
        }

        function save() {
            const states = {};
            activityList.forEach(a => {
                const cb = document.getElementById('c' + a.id);
                if(cb) states['c'+a.id] = cb.checked;
            });
            const data = { books, badges, earnedBadges, selectedBook, states };
            fetch(`${FIREBASE_URL}/${DEVICE_ID}/data.json`, { method: 'PUT', body: JSON.stringify(data) });
        }

        function load() {
            fetch(`${FIREBASE_URL}/${DEVICE_ID}/data.json`).then(r => r.json()).then(data => {
                if (!data) return;
                if (data.states) {
                    Object.keys(data.states).forEach(id => {
                        const cb = document.getElementById(id);
                        if(cb) { cb.checked = data.states[id]; updateActivityCard(id.replace('c',''), true); }
                    });
                }
                earnedBadges = data.earnedBadges || [];
                displayRewards();
            });
        }

        function resetDay() {
            activityList.forEach(a => {
                const cb = document.getElementById('c' + a.id);
                cb.checked = false;
                updateActivityCard(a.id, true);
            });
            save();
        }

        window.onload = () => { renderActivities(); load(); };
    </script>
</body>
</html>
