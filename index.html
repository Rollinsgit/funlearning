<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juliette's Learning Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Comic Sans MS', 'Trebuchet MS', 'Arial', sans-serif; 
            background: linear-gradient(135deg, #FFB6D9, #FFD700, #87CEEB, #98FF98);
            padding: 15px; 
            color: #333; 
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { 
            background: linear-gradient(135deg, #FF1493, #FF69B4);
            padding: 25px; 
            border-radius: 25px; 
            margin-bottom: 20px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            text-align: center;
            border: 5px solid #FFD700;
        }
        .header h1 { color: white; font-size: 2.5rem; text-shadow: 3px 3px 0px rgba(0,0,0,0.3); }
        
        /* TABS */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab-btn { 
            background: linear-gradient(135deg, #00D4FF, #0099FF);
            padding: 15px 20px; 
            border-radius: 20px; 
            cursor: pointer; 
            font-weight: 700; 
            color: white; 
            border: 4px solid white;
            transition: all 0.3s;
        }
        .tab-btn.active { background: linear-gradient(135deg, #FF1493, #FF69B4); border-color: #FFD700; }

        .content { 
            background: white; 
            padding: 25px; 
            border-radius: 20px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.15); 
            display: none;
            border: 5px solid #FFD700;
        }
        .content.active { display: block; }

        /* ACTIVITIES */
        .activity-card {
            background: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 12px;
            border: 3px solid #FFD700;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        /* Pulse when checked */
        @keyframes activityPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .activity-card.checked {
            background: #eaffea;
            border-color: #00AA00;
            animation: activityPulse 0.3s ease-out;
        }

        input[type="checkbox"] {
            width: 35px;
            height: 35px;
            accent-color: #00AA00;
        }

        /* BADGES */
        .badge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
        }
        
        @keyframes badgePop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3) rotate(10deg); }
            100% { transform: scale(1.1) rotate(5deg); }
        }

        .badge-btn {
            background: #f0f0f0;
            padding: 20px;
            border-radius: 15px;
            border: 3px solid #ddd;
            font-size: 2rem;
            cursor: pointer;
            text-align: center;
        }

        .badge-btn.earned {
            background: linear-gradient(135deg, #FFF7AD, #FFD700);
            border-color: #FF1493;
            animation: badgePop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .btn { 
            background: #0099FF; color: white; padding: 10px 20px; 
            border-radius: 10px; border: none; font-weight: bold; cursor: pointer;
        }
        .btn-danger { background: #FF4444; margin-bottom: 15px; }

        /* BOOKS */
        .book-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 15px; }
        .book-btn { border: 3px solid #FFD700; padding: 10px; border-radius: 10px; text-align: center; cursor: pointer; }
        .book-btn.selected { background: #FFF7AD; border-color: #FF1493; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>üéâ Juliette's Dashboard üéâ</h1>
    </div>
    
    <div class="tabs">
        <button class="tab-btn active" onclick="showTab('activities')">üìö Activities</button>
        <button class="tab-btn" onclick="showTab('books')">üìñ Books</button>
        <button class="tab-btn" onclick="showTab('rewards')">üèÜ Rewards</button>
    </div>
    
    <div id="activities" class="content active">
        <button class="btn btn-danger" onclick="resetDay()">üîÑ Reset Today</button>
        <div id="activitySection"></div>
    </div>
    
    <div id="books" class="content">
        <div class="book-grid" id="bookGrid"></div>
    </div>
    
    <div id="rewards" class="content">
        <h3>Click a badge to earn it!</h3>
        <div class="badge-grid" id="badgeGrid"></div>
        <hr style="margin: 20px 0;">
        <h3>My Collection</h3>
        <div id="earnedDisplay" style="display:flex; gap:10px; flex-wrap:wrap;"></div>
    </div>
</div>

<script>
    // --- AUDIO ---
    const woodBlockSound = new Audio('https://www.soundjay.com/button/sounds/button-20.mp3'); 
    const rewardChime = new Audio('https://www.soundjay.com/communication/sounds/bell-ringing-05.mp3');
    
    woodBlockSound.volume = 0.15;
    rewardChime.volume = 0.1;

    // --- DATA ---
    const FIREBASE_URL = 'https://funlearning-f53a4-default-rtdb.firebaseio.com';
    const DEVICE_ID = 'juliette_shared_data';

    let books = [["üìö", "Adventure Time"], ["üßö", "Fairy Tales"]];
    let badges = [["üåü", "Star"], ["üèÜ", "Champ"], ["üé®", "Artist"], ["üß†", "Smarty"]];
    let earnedBadges = [];
    let selectedBook = null;

    const activityList = [
        {id: 1, label: "üì± Reading.com"},
        {id: 2, label: "üåä SplashLearn"},
        {id: 3, label: "üåç Lingokids"},
        {id: 4, label: "üéì Khan Academy Kids"},
        {id: 5, label: "üìö Bob Books"},
        {id: 6, label: "üé® Arts & Crafts"}
    ];

    function playSound(type) {
        const s = (type === 'wood') ? woodBlockSound : rewardChime;
        s.currentTime = 0;
        s.play().catch(() => console.log("Click page to enable sound"));
    }

    function showTab(tab) {
        document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tab).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    function renderActivities() {
        let html = '';
        activityList.forEach(a => {
            html += `
            <div class="activity-card" id="a${a.id}" onclick="handleCardClick(${a.id})">
                <input type="checkbox" id="c${a.id}" onclick="event.stopPropagation(); updateActivityCard(${a.id})">
                <span style="font-size:1.2rem; font-weight:bold;">${a.label}</span>
            </div>`;
        });
        document.getElementById('activitySection').innerHTML = html;
    }

    function handleCardClick(id) {
        const cb = document.getElementById('c' + id);
        cb.checked = !cb.checked;
        updateActivityCard(id);
    }

    function updateActivityCard(id, silent = false) {
        const cb = document.getElementById('c' + id);
        const card = document.getElementById('a' + id);
        if (cb.checked) {
            card.classList.add('checked');
            if (!silent) playSound('wood');
        } else {
            card.classList.remove('checked');
        }
        save();
    }

    function toggleBadge(idx) {
        if (earnedBadges.includes(idx)) {
            earnedBadges = earnedBadges.filter(i => i !== idx);
        } else {
            earnedBadges.push(idx);
            playSound('reward');
        }
        displayRewards();
        save();
    }

    function displayRewards() {
        let gridHtml = '';
        badges.forEach((b, i) => {
            const isEarned = earnedBadges.includes(i);
            gridHtml += `<div class="badge-btn ${isEarned ? 'earned' : ''}" onclick="toggleBadge(${i})">${b[0]}</div>`;
        });
        document.getElementById('badgeGrid').innerHTML = gridHtml;

        let earnedHtml = '';
        earnedBadges.forEach(i => {
            earnedHtml += `<div style="font-size:2rem; padding:10px; background:white; border-radius:10px; border:2px solid #FFD700;">${badges[i][0]}</div>`;
        });
        document.getElementById('earnedDisplay').innerHTML = earnedHtml || 'Keep working to earn badges!';
    }

    function resetDay() {
        activityList.forEach(a => {
            const cb = document.getElementById('c' + a.id);
            cb.checked = false;
            updateActivityCard(a.id, true);
        });
        save();
    }

    // --- FIREBASE ---
    function save() {
        const states = {};
        activityList.forEach(a => states['c'+a.id] = document.getElementById('c'+a.id).checked);
        const data = { earnedBadges, states, selectedBook, books, badges };
        fetch(`${FIREBASE_URL}/${DEVICE_ID}/data.json`, { method: 'PUT', body: JSON.stringify(data) });
    }

    function load() {
        fetch(`${FIREBASE_URL}/${DEVICE_ID}/data.json`).then(r => r.json()).then(data => {
            if (!data) return;
            earnedBadges = data.earnedBadges || [];
            if (data.states) {
                Object.keys(data.states).forEach(id => {
                    const cb = document.getElementById(id);
                    if (cb) {
                        cb.checked = data.states[id];
                        updateActivityCard(id.replace('c',''), true);
                    }
                });
            }
            displayRewards();
        });
    }

    window.onload = () => {
        renderActivities();
        load();
    };
</script>

</body>
</html>
